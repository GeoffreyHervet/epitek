#ifndef		_OPERANDS_HH_
#define		_OPERANDS_HH_

#include	<string>
#include	<iostream>
#include	<sstream>

#include	"IOperand.hh"
#include	"Stack.hh"
#include	"utils.h"

#define		MOD(x, y) ((x) - ((x) / (y)) * (y))

namespace	avm
{
  template <typename T>
  class Operand : public IOperand
  {
    public:
      Operand(std::string val, eOperandType type)
        : type(type), str(val)
      {
        std::stringstream     a;

        a.str(val);
        a >> this->value;
      };

      ~Operand(){};

      IOperand		*clone() const { return (new Operand<T>(this->toString(), this->type)); };
      IOperand		*clone(const std::string &val) const { return (new Operand<T>(val, this->type)); };

      std::string const&	toString() const {   return (this->str); };
      int			getPrecision() const {    return (static_cast<int>(this->type));};
      eOperandType		getType() const {    return (this->type); };
      T				getValue() const { return (this->value);};
      void			setValue(T val){ this->value = val; };

      IOperand		*cloneBigestPrec(const IOperand &rhs, std::string val) const
      {
        if (rhs.getPrecision() > this->getPrecision())
          return static_cast<const Operand & > (rhs).clone(val);
        return this->clone(val);
      };

      IOperand *operator+(const IOperand &rhs) const
      {
        return  this->cloneBigestPrec(rhs,utils::toStr(static_cast<const Operand & >(rhs).value + this->value));
      };

      IOperand *operator-(const IOperand &rhs) const
      {
        return  this->cloneBigestPrec(rhs,utils::toStr(static_cast<const Operand & >(rhs).value - this->value));
      };

      IOperand *operator*(const IOperand &rhs) const
      {
        return  this->cloneBigestPrec(rhs,utils::toStr(static_cast<const Operand & >(rhs).value * this->value));
      };

      IOperand *operator/(const IOperand &rhs) const
      {
        return  this->cloneBigestPrec(rhs,utils::toStr(static_cast<const Operand & >(rhs).value / this->value));
      };

      IOperand *operator%(const IOperand &rhs) const
      {
        return  this->cloneBigestPrec(rhs,utils::toStr(MOD(static_cast<const Operand & >(rhs).value,this->value)));
      };

    private:
      eOperandType          type;
      std::string           str;
      T                     value;
  };

};

#endif		/* _OPERANDS_HH_ */
